"use strict";

$(document).ready(function() {
  // ======================================
  // 1. BARRAS DE PROGRESO CIRCULARES
  // ======================================
  const initProgressCircles = () => {
    // Configuración común para todos los círculos
    const circleConfig = {
      max: 100,
      animation: { duration: 1500 },
      fill: { gradient: ["#3454d1", "#25b865"] }
    };

    // Progreso de objetivos (porcentaje)
    $(".goal-prigress").circleProgress({
      ...circleConfig,
      value: 63,
      textFormat: "percent"
    });

    // Progreso de ventas (valores monetarios)
    const salesProgress = [
      { selector: ".sales-progress-1", value: 50, text: "$450 USD" },
      { selector: ".sales-progress-2", value: 60, text: "$550 USD" },
      { selector: ".sales-progress-3", value: 70, text: "$850 USD" },
      { selector: ".sales-progress-4", value: 80, text: "$900 USD" }
    ];

    salesProgress.forEach(sale => {
      $(sale.selector).circleProgress({
        ...circleConfig,
        value: sale.value,
        textFormat: () => sale.text
      });
    });
  };

  // ======================================
  // 2. GRÁFICOS DE BARRAS MENSUALES
  // ======================================
  const initMonthlyBarCharts = () => {
    // Configuración base común para todos los gráficos de barras
    const baseBarConfig = {
      chart: {
        height: 352,
        width: "100%",
        stacked: false,
        type: "bar",
        toolbar: { show: false }
      },
      stroke: { show: false },
      plotOptions: {
        bar: {
          endingShape: "rounded",
          columnWidth: "20%",
          distributed: true,
          dataLabels: { position: "top" }
        }
      },
      markers: { size: 0 },
      xaxis: {
        categories: ["ENE/23","FEB/23","MAR/23","ABR/23","MAY/23","JUN/23",
                    "JUL/23","AGO/23","SEP/23","OCT/23","NOV/23","DIC/23"],
        axisBorder: { show: false },
        axisTicks: { show: false },
        labels: {
          style: {
            fontSize: "10px",
            colors: "#64748b"
          }
        }
      },
      yaxis: {
        labels: {
          formatter: (val) => `${val}K`,
          offsetX: -5,
          offsetY: 0,
          style: { color: "#64748b" }
        }
      },
      grid: {
        xaxis: { lines: { show: false } },
        yaxis: { lines: { show: false } }
      },
      tooltip: {
        y: { formatter: (val) => `${val}K` },
        style: {
          fontSize: "12px",
          fontFamily: "Inter"
        }
      },
      legend: { show: false }
    };

    // Gráfico de Leads
    new ApexCharts(document.querySelector("#leads-bar-chart"), {
      ...baseBarConfig,
      colors: Array(12).fill("#E9EDF7").fill("#3454D1", 3, 4),
      series: [{ name: "Leads", data: [20,30,40,50,46,42,38,34,30,28,26,25] }]
    }).render();

    // Gráfico de Propuestas
    new ApexCharts(document.querySelector("#proposal-bar-chart"), {
      ...baseBarConfig,
      colors: Array(12).fill("#E9EDF7").fill("#3454D1", 8, 9),
      series: [{ name: "Propuestas", data: [28,30,32,35,38,41,44,47,50,40,30,20] }]
    }).render();

    // Gráfico de Contratos
    new ApexCharts(document.querySelector("#contract-bar-chart"), {
      ...baseBarConfig,
      colors: Array(12).fill("#E9EDF7").fill("#3454D1", 5, 6),
      series: [{ name: "Contratos", data: [10,20,30,40,50,60,55,50,45,40,35,30] }]
    }).render();

    // Gráfico de Proyectos
    new ApexCharts(document.querySelector("#project-bar-chart"), {
      ...baseBarConfig,
      colors: Array(12).fill("#E9EDF7").fill("#3454D1", 6, 7),
      series: [{ name: "Proyectos", data: [10,20,30,40,50,60,65,50,45,40,35,30] }]
    }).render();
  };

  // ======================================
  // 3. GRÁFICOS SPARKLINE (MINI GRÁFICOS)
  // ======================================
  const initSparklineCharts = () => {
    // Configuración común para sparklines
    const sparklineConfig = {
      chart: {
        type: "area",
        height: 125,
        toolbar: { show: false },
        sparkline: { enabled: true }
      },
      stroke: {
        width: 2,
        curve: "smooth"
      },
      fill: {
        type: "gradient",
        gradient: {
          shadeIntensity: 1,
          opacityFrom: 0.2,
          opacityTo: 0.5,
          stops: [0, 90, 100]
        }
      },
      grid: { show: false },
      legend: { show: false },
      dataLabels: { enabled: false },
      tooltip: {
        y: { formatter: (val) => `${val}K` },
        style: {
          colors: "#64748b",
          fontFamily: "Inter"
        }
      }
    };

    // Gráfico de Ganancias
    new ApexCharts(document.querySelector("#earnings-area-chart"), {
      ...sparklineConfig,
      series: [{ name: "Ganancias", data: [25,60,20,90,45,100,55] }],
      colors: ["#25b865"]
    }).render();

    // Gráfico de Gastos
    new ApexCharts(document.querySelector("#expense-area-chart"), {
      ...sparklineConfig,
      series: [{ name: "Gastos", data: [25,60,20,90,45,100,55] }],
      colors: ["#d13b4c"]
    }).render();
  };

  // ======================================
  // INICIALIZAR TODOS LOS COMPONENTES
  // ======================================
  initProgressCircles();
  initMonthlyBarCharts();
  initSparklineCharts();
});