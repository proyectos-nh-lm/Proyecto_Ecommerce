"use strict";

$(document).ready(function() {
  // ======================================
  // 1. BARRAS DE PROGRESO CIRCULARES
  // ======================================
  const initProgressCircles = () => {
    const progressBars = [
      { selector: ".project-progress-1, .team-progress-1", value: 40 },
      { selector: ".project-progress-2, .team-progress-2", value: 65 },
      { selector: ".project-progress-3, .team-progress-3", value: 50 },
      { selector: ".project-progress-4, .team-progress-4", value: 75 }
    ];

    progressBars.forEach(bar => {
      $(bar.selector).circleProgress({
        max: 100,
        value: bar.value,
        textFormat: "percent",
        animation: { duration: 1500 },
        fill: { gradient: ["#3454d1", "#25b865"] }
      });
    });
  };

  // ======================================
  // 2. CALENDARIO DE PROYECTOS
  // ======================================
  const initProjectCalendar = () => {
    const today = new Date();
    const events = [
      {
        startDate: new Date(today.setHours(today.getHours() + 24)).toDateString(),
        endDate: new Date(today.setHours(today.getHours() + 25)).toISOString(),
        summary: "Reunión con equipo de ventas"
      },
      {
        startDate: new Date(today.setHours(today.getHours() + 24)).toDateString(),
        endDate: new Date(today.setHours(today.getHours() + 25)).toISOString(),
        summary: "Desarrollo de App Móvil NFT"
      },
      // ... otros eventos (reducidos por brevedad)
    ];

    $("#project-calendar").simpleCalendar({
      displayEvent: true,
      events: events,
      disableEventDetails: false,
      disableEmptyDetails: false,
      language: "es" // Configuración en español
    });
  };

  // ======================================
  // 3. GRÁFICO DE ESTADÍSTICAS DE PROYECTOS
  // ======================================
  const initProjectStatsChart = () => {
    new ApexCharts(document.querySelector("#project-statistics-chart"), {
      chart: {
        height: 365,
        type: "area",
        stacked: false,
        toolbar: { show: false }
      },
      xaxis: {
        categories: ["Sábado","Domingo","Lunes","Martes","Miércoles","Jueves","Viernes"],
        axisBorder: { show: false },
        axisTicks: { show: false },
        labels: {
          style: {
            fontSize: "11px",
            colors: "#64748b"
          }
        }
      },
      yaxis: {
        labels: {
          formatter: function(val) { return `${val}K` },
          offsetX: -22,
          offsetY: 0,
          style: {
            fontSize: "11px",
            color: "#64748b"
          }
        }
      },
      stroke: {
        curve: "smooth",
        width: [1, 1, 1],
        dashArray: [3, 3, 3],
        lineCap: "round"
      },
      grid: {
        padding: { left: 0, right: 0 },
        strokeDashArray: 3,
        borderColor: "#ebebf3",
        row: {
          colors: ["#ebebf3", "transparent"],
          opacity: .02
        }
      },
      legend: { show: false },
      colors: ["#3454d1", "#25b865", "#e49e3d"],
      dataLabels: { enabled: false },
      fill: {
        type: "gradient",
        gradient: {
          shadeIntensity: 1,
          opacityFrom: .4,
          opacityTo: .3,
          stops: [0, 100]
        }
      },
      series: [
        { name: "Tareas Completadas", data: [20,45,25,60,30,65,35], type: "area" },
        { name: "Proyectos Completados", data: [30,25,40,35,50,40,60], type: "area" },
        { name: "Próximos Proyectos", data: [45,20,50,25,65,30,75], type: "area" }
      ],
      tooltip: {
        y: { formatter: function(val) { return `${val}K` } },
        style: {
          fontSize: "11px",
          fontFamily: "Inter"
        }
      }
    }).render();
  };

  // ======================================
  // 4. GRÁFICO DE TIEMPO SEMANAL
  // ======================================
  const initWeeklyTimeChart = () => {
    const options = {
      chart: {
        height: 325,
        width: "100%",
        stacked: false,
        type: "bar",
        toolbar: { show: false }
      },
      stroke: { show: false },
      plotOptions: {
        bar: {
          endingShape: "rounded",
          columnWidth: "25%",
          distributed: true,
          dataLabels: { position: "top" }
        }
      },
      colors: ["#E9EDF7","#E9EDF7","#E9EDF7","#3454D1","#E9EDF7","#E9EDF7","#E9EDF7"],
      series: [{ name: "Tiempo", data: [200,300,400,500,460,420,380] }],
      markers: { size: 0 },
      xaxis: {
        categories: ["SÁB","DOM","LUN","MAR","MIÉ","JUE","VIE"],
        axisBorder: { show: false },
        axisTicks: { show: false },
        labels: {
          style: {
            fontSize: "10px",
            colors: "#64748b"
          }
        }
      },
      yaxis: {
        labels: {
          formatter: function(val) { return `${val}M` },
          offsetX: -5,
          offsetY: 0,
          style: { color: "#64748b" }
        }
      },
      grid: {
        xaxis: { lines: { show: false } },
        yaxis: { lines: { show: false } }
      },
      tooltip: {
        y: { formatter: function(val) { return `${val} MIN` } },
        style: {
          fontSize: "12px",
          fontFamily: "Inter"
        }
      },
      legend: { show: false }
    };

    new ApexCharts(document.querySelector("#weekly-time-spent-chart"), options).render();
  };

  // ======================================
  // INICIALIZAR TODOS LOS COMPONENTES
  // ======================================
  initProgressCircles();
  initProjectCalendar();
  initProjectStatsChart();
  initWeeklyTimeChart();
});