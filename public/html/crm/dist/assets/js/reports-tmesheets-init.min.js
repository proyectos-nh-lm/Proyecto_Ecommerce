"use strict";

$(document).ready(function() {
  // ======================================
  // 1. GRÁFICO DE TIEMPO REGISTRADO (ÁREA)
  // ======================================
  const initLoggedTimeChart = () => {
    new ApexCharts(document.querySelector("#logged-time-area-chart"), {
      chart: {
        height: 350,
        type: "area",
        stacked: false,
        toolbar: { show: false }
      },
      xaxis: {
        categories: ["08:30","09:30","10:30","11:30","12:30","13:30",
                    "14:30","15:30","16:30","17:30","18:30","19:30"],
        axisBorder: { show: false },
        axisTicks: { show: false },
        labels: {
          style: {
            fontSize: "11px",
            colors: "#64748b"
          }
        }
      },
      yaxis: {
        labels: {
          formatter: (val) => `${val} Min`, // Formato en minutos
          offsetX: -22,
          offsetY: 0,
          style: {
            fontSize: "11px",
            color: "#64748b"
          }
        }
      },
      stroke: {
        width: 2,
        curve: "smooth",
        lineCap: "round"
      },
      grid: {
        padding: { left: 0, right: 0 },
        strokeDashArray: 3,
        borderColor: "#ebebf3",
        row: {
          colors: ["#ebebf3", "transparent"],
          opacity: .02
        }
      },
      legend: { show: false },
      colors: ["#3454d1"], // Color azul corporativo
      dataLabels: { enabled: false },
      fill: {
        type: "gradient",
        gradient: {
          shadeIntensity: 1,
          opacityFrom: .4,
          opacityTo: .8,
          stops: [0, 100]
        }
      },
      series: [{
        name: "Tiempo Registrado",
        data: [20,45,25,60,30,65,35,75,60,80,65,95],
        type: "area"
      }],
      tooltip: {
        y: { formatter: (val) => `${val} Min` },
        style: {
          fontSize: "11px",
          fontFamily: "Inter"
        }
      }
    }).render();
  };

  // ======================================
  // 2. GRÁFICO DE TIEMPO FACTURABLE (BARRAS)
  // ======================================
  const initBillableTimeChart = () => {
    new ApexCharts(document.querySelector("#billable-time-bar-chart"), {
      chart: {
        height: 350,
        width: "100%",
        stacked: false,
        type: "bar",
        toolbar: { show: false }
      },
      stroke: { show: false },
      plotOptions: {
        bar: {
          endingShape: "rounded",
          columnWidth: "30%",
          distributed: false,
          dataLabels: { position: "top" }
        }
      },
      colors: ["#e5e7eb", "#3454D1"], // Gris claro y azul
      series: [
        { name: "Tiempo Total", data: [20,30,40,50,46,42,38,34,30,28,26,25] },
        { name: "Tiempo Facturable", data: [15,25,35,45,41,38,33,28,23,18,13,10] }
      ],
      markers: { size: 0 },
      xaxis: {
        categories: ["08:30","09:30","10:30","11:30","12:30","13:30",
                    "14:30","15:30","16:30","17:30","18:30","19:30"],
        axisBorder: { show: false },
        axisTicks: { show: false },
        labels: {
          style: {
            fontSize: "10px",
            colors: "#64748b"
          }
        }
      },
      yaxis: {
        labels: {
          formatter: (val) => `${val} Min`,
          offsetX: -5,
          offsetY: 0,
          style: { color: "#64748b" }
        }
      },
      grid: {
        xaxis: { lines: { show: false } },
        yaxis: { lines: { show: false } }
      },
      tooltip: {
        y: { formatter: (val) => `${val} Min` },
        style: {
          fontSize: "12px",
          fontFamily: "Inter"
        }
      },
      legend: {
        show: true,
        position: "top",
        labels: {
          fontSize: "12px",
          colors: "#64748b",
          fontFamily: "Inter"
        }
      }
    }).render();
  };

  // ======================================
  // 3. INDICADORES CIRCULARES DE PROGRESO
  // ======================================
  const initProgressCircles = () => {
    const circleConfig = {
      max: 100,
      animation: { duration: 1500 },
      fill: { gradient: ["#3454d1", "#25b865"] }
    };

    // Progreso de tiempos
    $(".times-progress-chart").circleProgress({
      ...circleConfig,
      value: 40,
      textFormat: "percent"
    });

    // Progreso de tareas
    $(".tasks-progress-chart").circleProgress({
      ...circleConfig,
      value: 50,
      textFormat: "percent"
    });

    // Progreso de proyectos
    $(".projects-progress-chart").circleProgress({
      ...circleConfig,
      value: 65,
      textFormat: "percent"
    });
  };

  // ======================================
  // INICIALIZAR TODOS LOS COMPONENTES
  // ======================================
  initLoggedTimeChart();
  initBillableTimeChart();
  initProgressCircles();
});