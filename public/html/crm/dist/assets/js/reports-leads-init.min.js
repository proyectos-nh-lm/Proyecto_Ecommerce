"use strict";

$(document).ready(function() {
  // ======================================
  // 1. GRÁFICO DE SEGUIMIENTO DE LEADS
  // ======================================
  const initLeadsTrackingChart = () => {
    new ApexCharts(document.querySelector("#leads-inquiry-tracking"), {
      chart: {
        height: 350,
        width: "100%",
        stacked: false,
        type: "bar",
        toolbar: { show: false }
      },
      stroke: { show: false },
      plotOptions: {
        bar: {
          endingShape: "rounded",
          columnWidth: "30%",
          distributed: false,
          dataLabels: { position: "top" }
        }
      },
      colors: ["#3454D1", "#e5e7eb"], // Azul principal y gris
      series: [
        { name: "Nuevos", data: [20,30,40,50,46,42,38,34,30,28,26,25] },
        { name: "Resueltos", data: [15,25,35,45,41,38,33,28,23,18,13,10] }
      ],
      markers: { size: 0 },
      xaxis: {
        categories: ["ENE/23","FEB/23","MAR/23","ABR/23","MAY/23","JUN/23",
                    "JUL/23","AGO/23","SEP/23","OCT/23","NOV/23","DIC/23"],
        axisBorder: { show: false },
        axisTicks: { show: false },
        labels: {
          style: {
            fontSize: "10px",
            colors: "#64748b"
          }
        }
      },
      yaxis: {
        labels: {
          formatter: function(val) { return `${val}K` },
          offsetX: -5,
          offsetY: 0,
          style: { color: "#64748b" }
        }
      },
      grid: {
        xaxis: { lines: { show: false } },
        yaxis: { lines: { show: false } }
      },
      tooltip: {
        y: { formatter: function(val) { return `${val}K` } },
        style: {
          fontSize: "12px",
          fontFamily: "Inter"
        }
      },
      legend: {
        show: true,
        position: "top",
        labels: {
          fontSize: "12px",
          colors: "#64748b"
        }
      }
    }).render();
  };

  // ======================================
  // 2. GRÁFICO DE CANALES DE LEADS
  // ======================================
  const initLeadsChannelChart = () => {
    new ApexCharts(document.querySelector("#leads-inquiry-channel"), {
      chart: {
        type: "bar",
        height: 350,
        stacked: true,
        toolbar: { show: false }
      },
      plotOptions: {
        bar: {
          endingShape: "rounded",
          columnWidth: "20%",
          horizontal: false
        }
      },
      colors: ["#283c50","#3454d1","#fb8500","#25b865","#ffb703"], // Paleta de colores
      series: [
        { name: "Leads", data: [4,5,4,6,3,4,5,4,6,3,4,5] },
        { name: "Activos", data: [3,4,3,6,5,3,3,6,2,5,4,3] },
        { name: "Pendientes", data: [4,5,4,6,3,4,5,4,6,3,4,6] },
        { name: "Resueltos", data: [4,5,4,6,3,4,5,4,6,3,4,5] },
        { name: "Cancelados", data: [4,5,4,6,3,4,5,4,6,3,4,5] }
      ],
      xaxis: {
        categories: ["ENE/22","FEB/22","MAR/22","ABR/22","MAY/22","JUN/22",
                    "JUL/22","AGO/22","SEP/22","OCT/22","NOV/22","DIC/22"],
        axisBorder: { show: false },
        axisTicks: { show: false },
        labels: {
          style: {
            fontSize: "10px",
            colors: "#64748b"
          }
        }
      },
      yaxis: {
        labels: {
          formatter: function(val) { return `${val}K` },
          offsetX: -5,
          offsetY: 0,
          style: { color: "#64748b" }
        }
      },
      grid: {
        xaxis: { lines: { show: false } },
        yaxis: { lines: { show: false } }
      },
      dataLabels: { enabled: false },
      tooltip: {
        shared: true,
        inverseOrder: true,
        y: { formatter: function(val) { return `${val}K` } },
        style: {
          fontSize: "11px",
          fontFamily: "Inter"
        }
      },
      legend: {
        show: true,
        position: "top",
        horizontalAlign: "left",
        fontSize: "12px",
        fontFamily: "Inter",
        labels: {
          fontSize: "12px",
          colors: "#64748b"
        },
        markers: {
          width: 10,
          height: 10,
          radius: 25
        },
        itemMargin: {
          horizontal: 15,
          vertical: 5
        }
      }
    }).render();
  };

  // ======================================
  // 3. BARRAS DE PROGRESO CIRCULARES
  // ======================================
  const initProgressCircles = () => {
    const progressBars = [
      { selector: ".lead-progress-1", value: 60, text: "$975 USD" },
      { selector: ".lead-progress-2", value: 55, text: "$850 USD" },
      { selector: ".lead-progress-3", value: 50, text: "$1500 USD" }
    ];

    progressBars.forEach(bar => {
      $(bar.selector).circleProgress({
        max: 100,
        value: bar.value,
        textFormat: () => bar.text,
        animation: { duration: 1500 },
        fill: { gradient: ["#3454d1", "#25b865"] }
      });
    });
  };

  // ======================================
  // INICIALIZAR TODOS LOS COMPONENTES
  // ======================================
  initLeadsTrackingChart();
  initLeadsChannelChart();
  initProgressCircles();
});